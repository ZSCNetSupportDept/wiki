<!-- TITLE: MacOS 系统建立PPPoE拨号 -->
<!-- SUBTITLE: 本文章旨在科普 macOS 系统建立PPPoE拨号教程以及简单错误排查说明 -->

# 建立PPPoE教程

## 步骤

1. 点击左上角 **苹果图标**, 选择 **系统偏好设置 | 网络** 进入网络设置界面
2. 确定适配器已经连接好，网线连接好
3. 选中对应的适配器页面，在 **配置IPv4** 右边下拉框选择 **创建PPPoE服务**, 服务名称用默认的就行
4. 在左侧选中新建的 PPPoE 进入 PPPoE 设置页面，填写 **帐户名称** 和 **密码**, 选择 **记住此密码**
5. 点击右下方的 **应用** 保存设置，然后点击 **连接** 即可建立拨号

## 录屏教程

![MAC系统建立PPPoE拨号录屏教程](/uploads/kp-macos-PPPOE-1.gif)

# macOS PPPoE排障指引

## 错误说明

### 未能找到PPPoE服务器 

1. 按照 Windows 系统拨号651错误处理流程处理，检查线路连接
2. 注意 macOS 系统有的适配器也是需要安装驱动的(特别是绿联的某型号)，可以看看IP有没有正常获取得到，或者插拔网线有没有反应(不会判断驱动有没有安装的话不如换台电脑检测线路是否正常?)

### 提示: 鉴定失败

按照 Windows 系统拨号691错误处理流程处理

1. 检查账号密码有没有输错
2. 是否接了正确的运营商线路
3. 账号是否正常状态(欠费/异常断线导致挂死)
4. 账号有没有被运营商绑定(解绑)

### 通过日志排障

1. 点击一下桌面
2. 在最上方找到 **前往**, 选择 **实用工具**
3. 找到 **控制台** , 双击启动
4. 在启动 **控制台** 以后，立刻出现的这个日志界面，你可以点一下窗口上方的 **清除** ，然后重新插拔转换器，可以帮助你判断转换器有没有装驱动或者是否损坏
5. 单击左侧的 `/var/log`, 然后在中间单击 `ppp.log`, 这样你可以看到拨号连接的日志，尽情玩耍(翻车吧)
6. 如果觉得 `ppp.log` 的日志信息不够多，回到 **系统偏好设置 | 网络** - PPPoE 的账号密码设置的那个界面，点击 **高级**,然后再点击 **PPP**, 选中使用详细记录, 然后选择 **应用** 保存设置，这样能获得更详细的拨号日志信息

#### PPPoE排障记录

假如你已经跟着日志排障做到这一步了

这里做一个移动运营商的PPPoE故障记录不知道对你有没有帮助，在2018年8-10月期间，移动运营商曾经发生过一次针对MAC OS的拨号故障

故障现象为拨号提示 **未能建立与 PPP 服务器的连接**, 所有的MAC OS系统都是这样，并且有可能十次拨号成功连接一次。

开启 PPPoE 的详细记录，查看日志可以发现其实客户端已经成功发现PPPoE服务器，并且已经成功建立连接

后期会出现 `timeout` 并且 `connection terminated`

![macOS系统建立PPPoE-移动错误记录](/uploads/kp-macos-PPPOE-2.jpg)

使用抓包软件抓包分析会发现，MAC OS在该网络下建立PPPoE连接，在PPP LCP通讯过程中，会使用两个不同的魔术字建立连接，导致无法通过bras认证

后期由于某压力情况下，开启了 `ppp-initial-delay` 配置，问题解决。但是其实当时是没有找到出现本错误的最终原因的，只是增加策略解决了本问题

未免后期再次出现类似故障，在此记录

PS:这个故障并非针对学校，我们去了中山很多个小区测试，均有此故障
(故障记录人:三线)


